#!/usr/bin/env bash

HOST=kaylee
PUBLIC_PORT=3002
APP_PORT=3001
CONTAINER_NAME=ldd-transform
IMAGE_NAME=sbnpsi/ldd-transform
TAG=latest


echo "deploying ldd-transform to kaylee"
echo ""

echo "pull docker image"
ssh $HOST docker pull $IMAGE_NAME:$TAG

echo "stop existing container (if it exists) and prune containers/images"
ssh $HOST docker kill $CONTAINER_NAME
ssh $HOST docker container prune -f && docker image prune -f

echo "start updated container"
ssh $HOST docker run -d -p $PUBLIC_PORT:$APP_PORT --name $CONTAINER_NAME --restart always $IMAGE_NAME:$TAG

echo "Done."
